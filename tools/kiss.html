<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>KISS Doll Interface (Offline)</title>

<style>
  :root {
    --stage-w: 634px;
    --stage-h: 877px;
  }

  html, body {
    margin: 0;
    padding: 0;
    background: #f2f2f2;
    font-family: Arial, Helvetica, sans-serif;
    user-select: none;
    height: 100%;
  }

  #app {
    display: flex;
    height: 100vh;
  }

  /* LEFT TOOL PANEL */
  #palette {
    width: 320px;
    background: #222;
    color: #fff;
    padding: 12px;
    overflow-y: auto;
    box-sizing: border-box;
  }

  #palette .title {
    font-size: 18px;
    font-weight: 700;
    letter-spacing: 0.5px;
    margin: 6px 0 10px;
  }

  #palette h2 {
    margin: 12px 0 8px;
    font-size: 13px;
    border-bottom: 1px solid #444;
    padding-bottom: 4px;
    letter-spacing: 0.4px;
    text-transform: uppercase;
    opacity: 0.95;
  }

  .item {
    background: #333;
    border: 1px solid #555;
    margin-bottom: 8px;
    padding: 8px 8px;
    cursor: pointer;
    text-align: center;
    font-size: 12px;
    border-radius: 6px;
  }

  .item:hover {
    background: #444;
  }

  .row {
    display: flex;
    gap: 8px;
  }

  .row .item {
    flex: 1;
  }

  .hint {
    margin-top: 10px;
    font-size: 12px;
    color: #cfcfcf;
    line-height: 1.35;
    opacity: 0.9;
  }

  /* MAIN CANVAS */
  #stage-container {
    flex: 1;
    display: flex;
    justify-content: center;
    align-items: center;
    background: #d8d8d8;
    padding: 12px;
    box-sizing: border-box;
    overflow: hidden;
    min-height: 0;
  }

  #stage-wrap {
    position: relative;
    box-shadow: 0 12px 40px rgba(0, 0, 0, 0.28);
  }

  #stage {
    position: relative;
    width: var(--stage-w);
    height: var(--stage-h);
    transform-origin: top left;
  }

  .layer {
    position: absolute;
    top: 0;
    left: 0;
    pointer-events: none;
    user-select: none;
  }

  .bg {
    width: 100%;
    height: 100%;
  }

  .z-body { z-index: 10; }
  .z-clothes { z-index: 20; }
  .z-head { z-index: 30; }
  .z-headgear { z-index: 35; }
  .z-face { z-index: 40; }
  .z-prop { z-index: 50; }

  .draggable {
    pointer-events: auto;
    cursor: grab;
    touch-action: none;
  }

  .hidden {
    display: none;
  }

  /* Small status line at bottom */
  #status {
    margin-top: 10px;
    font-size: 12px;
    color: #cfcfcf;
    opacity: 0.95;
  }

  @media (max-width: 900px) {
    #app { flex-direction: column; }
    #palette { width: 100%; height: 320px; }
    #stage-container { height: calc(100vh - 320px); }
  }
</style>
</head>

<body>
<div id="app">

  <!-- PALETTE -->
  <div id="palette">
    <div class="title">KISS Doll (Offline)</div>

    <h2>Heads</h2>
    <div class="row">
      <div class="item" onclick="setExclusive('heads', 'head1')">Head A</div>
      <div class="item" onclick="setExclusive('heads', 'head2')">Head B</div>
      <div class="item" onclick="setExclusive('heads', 'head3')">Head C</div>
    </div>
    <div class="row">
      <div class="item" onclick="clearGroup('heads')">Clear Heads</div>
    </div>

    <h2>Full Outfits</h2>
    <div class="row">
      <div class="item" onclick="setExclusive('fullOutfits', 'outfitCow')">Cow Suit</div>
      <div class="item" onclick="setExclusive('fullOutfits', 'outfitMesh')">Mesh Outfit</div>
    </div>
    <div class="row">
      <div class="item" onclick="clearGroup('fullOutfits')">Clear Outfits</div>
    </div>

    <h2>Separates</h2>
    <div class="row">
      <div class="item" onclick="toggleLayer('topGreen')">Green Shirt</div>
      <div class="item" onclick="toggleLayer('pantsWhite')">White Pants</div>
    </div>

    <h2>Head &amp; Face</h2>
    <div class="row">
      <div class="item" onclick="toggleLayer('hairBlue')">Blue Hair</div>
      <div class="item" onclick="toggleLayer('crown')">Crown</div>
    </div>
    <div class="row">
      <div class="item" onclick="toggleLayer('sunglasses')">Sunglasses</div>
      <div class="item" onclick="toggleLayer('necklace')">Necklace</div>
    </div>

    <h2>Props (Draggable)</h2>
    <div class="row">
      <div class="item" onclick="toggleLayer('bat')">Bat</div>
      <div class="item" onclick="toggleLayer('megaphone')">Megaphone</div>
    </div>
    <div class="row">
      <div class="item" onclick="toggleLayer('suitcase')">Suitcase</div>
      <div class="item" onclick="toggleLayer('money')">Money</div>
    </div>
    <div class="row">
      <div class="item" onclick="toggleLayer('toiletPaper')">Toilet Paper</div>
      <div class="item" onclick="toggleLayer('heart')">Heart</div>
    </div>
    <div class="row">
      <div class="item" onclick="toggleLayer('exclamation')">Exclamation</div>
      <div class="item" onclick="toggleLayer('cursor')">Cursor</div>
    </div>

    <h2>Actions</h2>
    <div class="row">
      <div class="item" onclick="randomize()">Randomize</div>
      <div class="item" onclick="resetAll()">Reset</div>
    </div>

    <div class="hint">
      Pieces start around the sides; drag them onto the body.<br>
      Use buttons to show or hide layers if needed.<br>
      All art loads locally; no network needed.
      <div id="status"></div>
    </div>
  </div>

  <!-- STAGE -->
  <div id="stage-container">
    <div id="stage-wrap">
      <div id="stage">
        <img id="bg" class="layer bg" src="k1.png" alt="background" width="634" height="877" />

        <img id="body" class="layer z-body draggable" src="k9.png" alt="body" width="178" height="431" style="left: 228px; top: 230px;" data-start-x="228" data-start-y="230" />

        <img id="outfitCow" class="layer z-clothes draggable" src="k3.png" alt="cow suit" width="173" height="381" style="left: 20px; top: 220px;" data-start-x="20" data-start-y="220" />
        <img id="outfitMesh" class="layer z-clothes draggable" src="k13.png" alt="mesh outfit" width="113" height="371" style="left: 470px; top: 220px;" data-start-x="470" data-start-y="220" />
        <img id="topGreen" class="layer z-clothes draggable" src="k16.png" alt="green shirt" width="155" height="152" style="left: 430px; top: 60px;" data-start-x="430" data-start-y="60" />
        <img id="pantsWhite" class="layer z-clothes draggable" src="k19.png" alt="white pants" width="116" height="268" style="left: 40px; top: 609px;" data-start-x="40" data-start-y="609" />

        <img id="head1" class="layer z-head draggable" src="k5.png" alt="head 1" width="50" height="75" style="left: 260px; top: 40px;" data-start-x="260" data-start-y="40" />
        <img id="head2" class="layer z-head draggable" src="k6.png" alt="head 2" width="48" height="60" style="left: 320px; top: 40px;" data-start-x="320" data-start-y="40" />
        <img id="head3" class="layer z-head draggable" src="k7.png" alt="head 3" width="45" height="68" style="left: 380px; top: 40px;" data-start-x="380" data-start-y="40" />

        <img id="hairBlue" class="layer z-headgear draggable" src="k12.png" alt="blue hair" width="171" height="137" style="left: 20px; top: 60px;" data-start-x="20" data-start-y="60" />
        <img id="crown" class="layer z-headgear draggable" src="k2.png" alt="crown" width="51" height="64" style="left: 260px; top: 130px;" data-start-x="260" data-start-y="130" />
        <img id="sunglasses" class="layer z-face draggable" src="k22.png" alt="sunglasses" width="48" height="40" style="left: 320px; top: 140px;" data-start-x="320" data-start-y="140" />
        <img id="necklace" class="layer z-face draggable" src="k8.png" alt="necklace" width="29" height="17" style="left: 380px; top: 150px;" data-start-x="380" data-start-y="150" />

        <img id="bat" class="layer z-prop draggable" src="k10.png" alt="bat" width="42" height="188" style="left: 180px; top: 670px;" data-start-x="180" data-start-y="670" />
        <img id="megaphone" class="layer z-prop draggable" src="k17.png" alt="megaphone" width="121" height="134" style="left: 360px; top: 680px;" data-start-x="360" data-start-y="680" />
        <img id="suitcase" class="layer z-prop draggable" src="k18.png" alt="suitcase" width="114" height="111" style="left: 240px; top: 760px;" data-start-x="240" data-start-y="760" />
        <img id="money" class="layer z-prop draggable" src="k20.png" alt="money" width="61" height="132" style="left: 500px; top: 670px;" data-start-x="500" data-start-y="670" />
        <img id="toiletPaper" class="layer z-prop draggable" src="k21.png" alt="toilet paper" width="88" height="55" style="left: 420px; top: 820px;" data-start-x="420" data-start-y="820" />
        <img id="heart" class="layer z-prop draggable" src="k15.png" alt="heart" width="60" height="63" style="left: 290px; top: 670px;" data-start-x="290" data-start-y="670" />
        <img id="exclamation" class="layer z-prop draggable" src="k11.png" alt="exclamation" width="28" height="68" style="left: 230px; top: 670px;" data-start-x="230" data-start-y="670" />
        <img id="cursor" class="layer z-prop draggable" src="k14.png" alt="cursor" width="49" height="72" style="left: 230px; top: 750px;" data-start-x="230" data-start-y="750" />
      </div>
    </div>
  </div>

</div>

<script>
  const STAGE_W = 634;
  const STAGE_H = 877;
  let currentScale = 1;

  const groups = {
    heads: ["head1", "head2", "head3"],
    fullOutfits: ["outfitCow", "outfitMesh"]
  };

  const toggleIds = Array.from(new Set([
    ...groups.heads,
    ...groups.fullOutfits,
    "topGreen",
    "pantsWhite",
    "hairBlue",
    "crown",
    "sunglasses",
    "necklace",
    "bat",
    "megaphone",
    "suitcase",
    "money",
    "toiletPaper",
    "heart",
    "exclamation",
    "cursor"
  ]));

  function setStageScale() {
    const container = document.getElementById("stage-container");
    const wrap = document.getElementById("stage-wrap");
    const stage = document.getElementById("stage");

    const maxW = Math.max(container.clientWidth - 24, 0);
    const maxH = Math.max(container.clientHeight - 24, 0);
    const scale = Math.min(maxW / STAGE_W, maxH / STAGE_H, 1);

    currentScale = Number.isFinite(scale) && scale > 0 ? scale : 1;
    stage.style.transform = "scale(" + currentScale.toFixed(4) + ")";
    wrap.style.width = Math.round(STAGE_W * currentScale) + "px";
    wrap.style.height = Math.round(STAGE_H * currentScale) + "px";
  }

  function setStatus(msg) {
    const status = document.getElementById("status");
    status.textContent = msg;
  }

  function toggleLayer(id, silent) {
    const el = document.getElementById(id);
    if (!el) return;
    el.classList.toggle("hidden");
    if (!silent) setStatus("Toggled: " + id);
  }

  function setExclusive(groupName, idToShow, silent) {
    const ids = groups[groupName] || [];
    for (const id of ids) {
      const el = document.getElementById(id);
      if (!el) continue;
      if (id === idToShow) {
        el.classList.remove("hidden");
      } else {
        el.classList.add("hidden");
      }
    }
    if (!silent) setStatus("Selected " + groupName + ": " + idToShow);
  }

  function clearGroup(groupName, silent) {
    const ids = groups[groupName] || [];
    for (const id of ids) {
      const el = document.getElementById(id);
      if (el) el.classList.add("hidden");
    }
    if (!silent) setStatus("Cleared " + groupName + ".");
  }

  function resetDraggables() {
    const draggables = document.querySelectorAll(".draggable");
    draggables.forEach((el) => {
      const startX = Number(el.dataset.startX);
      const startY = Number(el.dataset.startY);
      if (!Number.isNaN(startX)) el.style.left = startX + "px";
      if (!Number.isNaN(startY)) el.style.top = startY + "px";
      el.style.zIndex = "";
    });
  }

  function resetAll() {
    for (const id of toggleIds) {
      const el = document.getElementById(id);
      if (el) el.classList.remove("hidden");
    }
    resetDraggables();
    setStatus("Reset all layers.");
  }

  function randomizeExclusive(groupName, showChance) {
    const ids = groups[groupName] || [];
    if (!ids.length) return;
    if (Math.random() > showChance) {
      clearGroup(groupName, true);
      return;
    }
    const pick = ids[Math.floor(Math.random() * ids.length)];
    setExclusive(groupName, pick, true);
  }

  function randomizeToggle(id, showChance) {
    const el = document.getElementById(id);
    if (!el) return;
    const show = Math.random() < showChance;
    el.classList.toggle("hidden", !show);
  }

  function randomize() {
    randomizeExclusive("heads", 0.6);

    if (Math.random() < 0.45) {
      randomizeExclusive("fullOutfits", 1);
      document.getElementById("topGreen").classList.add("hidden");
      document.getElementById("pantsWhite").classList.add("hidden");
    } else {
      clearGroup("fullOutfits", true);
      randomizeToggle("topGreen", 0.45);
      randomizeToggle("pantsWhite", 0.45);
    }

    const extras = [
      "hairBlue",
      "crown",
      "sunglasses",
      "necklace",
      "bat",
      "megaphone",
      "suitcase",
      "money",
      "toiletPaper",
      "heart",
      "exclamation",
      "cursor"
    ];

    for (const id of extras) {
      randomizeToggle(id, 0.35);
    }

    setStatus("Randomized.");
  }

  // --- Drag logic ---
  let dragTarget = null;
  let offsetX = 0;
  let offsetY = 0;
  let activePointerId = null;

  document.addEventListener("pointerdown", (e) => {
    const t = e.target;
    if (!t || !t.classList || !t.classList.contains("draggable")) return;
    dragTarget = t;
    activePointerId = e.pointerId;

    const stage = document.getElementById("stage");
    const stageRect = stage.getBoundingClientRect();
    const tRect = dragTarget.getBoundingClientRect();

    offsetX = (e.clientX - tRect.left) / currentScale;
    offsetY = (e.clientY - tRect.top) / currentScale;

    dragTarget.style.cursor = "grabbing";
    dragTarget.style.zIndex = "9999";
    if (dragTarget.setPointerCapture) {
      dragTarget.setPointerCapture(activePointerId);
    }
    setStatus("Dragging: " + dragTarget.id);
    e.preventDefault();
  });

  document.addEventListener("pointermove", (e) => {
    if (!dragTarget || e.pointerId !== activePointerId) return;
    const stage = document.getElementById("stage");
    const stageRect = stage.getBoundingClientRect();

    const x = (e.clientX - stageRect.left) / currentScale - offsetX;
    const y = (e.clientY - stageRect.top) / currentScale - offsetY;

    const maxX = STAGE_W - dragTarget.offsetWidth;
    const maxY = STAGE_H - dragTarget.offsetHeight;

    const clampedX = Math.min(Math.max(0, x), maxX);
    const clampedY = Math.min(Math.max(0, y), maxY);

    dragTarget.style.left = Math.round(clampedX) + "px";
    dragTarget.style.top = Math.round(clampedY) + "px";
  });

  function endDrag(e) {
    if (!dragTarget || (e && e.pointerId !== activePointerId)) return;
    if (dragTarget.releasePointerCapture && activePointerId !== null) {
      try {
        dragTarget.releasePointerCapture(activePointerId);
      } catch (err) {
        /* no-op */
      }
    }
    dragTarget.style.cursor = "grab";
    dragTarget.style.zIndex = "";
    setStatus("Dropped: " + dragTarget.id);
    dragTarget = null;
    activePointerId = null;
  }

  document.addEventListener("pointerup", endDrag);
  document.addEventListener("pointercancel", endDrag);

  window.addEventListener("load", () => {
    resetDraggables();
    setStageScale();
    setStatus("Ready.");
  });

  window.addEventListener("resize", () => {
    setStageScale();
  });
</script>

</body>
</html>
